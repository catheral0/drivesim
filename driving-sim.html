<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë²„ìŠ¤ ë“œë¼ì´ë¸Œ ì‹œë®¬ë ˆì´í„°</title>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=839a230b408a0505b1b525bdf2b8a2c1"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap');
  * { margin:0; padding:0; box-sizing:border-box; }
  :root { --amber:#ffb300; --amber-dim:#7a5500; --dark:#0d0a05; --panel:rgba(20,14,0,0.92); --red:#ff3322; --green:#00e676; }
  body { background:var(--dark); font-family:'Orbitron',monospace; color:var(--amber); height:100vh; overflow:hidden; display:flex; flex-direction:column; }

  #top-controls { flex-shrink:0; background:var(--panel); padding:8px 16px; display:flex; align-items:center; gap:10px; z-index:100; }
  #header-info { flex:1; }
  #header-info h1 { font-size:0.75rem; letter-spacing:3px; color:var(--amber); text-shadow:0 0 12px var(--amber); }
  #loc-name { font-family:'Share Tech Mono',monospace; font-size:0.6rem; color:rgba(255,179,0,0.6); margin-top:1px; }
  #start-btn { height:44px; padding:0 16px; border-radius:10px; border:2px solid var(--green); background:rgba(0,230,118,0.05); color:var(--green); font-family:'Orbitron',monospace; font-size:0.65rem; font-weight:700; letter-spacing:2px; cursor:pointer; flex-shrink:0; -webkit-tap-highlight-color:transparent; }
  #start-btn.running { border-color:var(--red); color:var(--red); box-shadow:0 0 12px rgba(255,51,34,0.3); }
  #map-btn { height:44px; padding:0 14px; border-radius:10px; border:2px solid rgba(255,179,0,0.5); background:rgba(255,179,0,0.05); color:var(--amber); font-family:'Orbitron',monospace; font-size:0.65rem; font-weight:700; letter-spacing:2px; cursor:pointer; flex-shrink:0; -webkit-tap-highlight-color:transparent; }

  #main-container { flex:1; position:relative; overflow:hidden; }
  #roadview { width:100%; height:100%; background:#1a1000; pointer-events:none; }

  #pillar-left, #pillar-right { position:absolute; top:0; bottom:0; width:18px; z-index:8; background:linear-gradient(90deg,#1a1200,#2a1e00); }
  #pillar-left { left:0; border-right:2px solid #3a2800; }
  #pillar-right { right:0; border-left:2px solid #3a2800; }

  #status-bar { position:absolute; top:8px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.75); border:1px solid rgba(255,179,0,0.3); border-radius:20px; padding:4px 14px; font-size:0.5rem; letter-spacing:2px; color:rgba(255,179,0,0.8); z-index:20; pointer-events:none; white-space:nowrap; }

  #bus-dash { position:absolute; bottom:0; left:0; right:0; height:38%; pointer-events:none; z-index:10; }
  #dash-panel { position:absolute; bottom:0; left:0; right:0; height:100%; background:linear-gradient(180deg,transparent 0%,rgba(10,7,0,0.55) 30%,#1a1200 60%,#0f0b00 100%); }

  #engine-light { position:absolute; right:14px; bottom:90px; display:flex; flex-direction:column; align-items:center; gap:3px; }
  #eng-dot { width:14px; height:14px; border-radius:50%; background:#222; border:2px solid #444; transition:all 0.3s; }
  #eng-dot.on { background:var(--green); border-color:var(--green); box-shadow:0 0 12px var(--green); animation:blink 2s infinite; }
  @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.4} }
  #eng-label { font-size:0.38rem; color:rgba(255,179,0,0.4); letter-spacing:1px; }

  #wheel-area { position:absolute; bottom:0; left:0; right:0; height:105px; display:flex; align-items:center; justify-content:center; pointer-events:all; }
  #left-zone { flex:1; height:100%; display:flex; align-items:center; justify-content:flex-end; padding-right:10px; }
  #right-zone { flex:1; height:100%; display:flex; align-items:center; justify-content:flex-start; padding-left:10px; }
  #wheel-container { width:110px; height:105px; display:flex; align-items:center; justify-content:center; position:relative; flex-shrink:0; }
  #steering-wheel { width:105px; height:105px; position:absolute; bottom:-8px; transition:transform 0.25s ease; filter:drop-shadow(0 0 10px rgba(255,179,0,0.2)); cursor:pointer; }
  .turn-btn { width:50px; height:50px; border-radius:50%; border:2px solid rgba(255,179,0,0.4); background:rgba(255,179,0,0.05); color:var(--amber); font-size:1.1rem; cursor:pointer; display:flex; align-items:center; justify-content:center; -webkit-tap-highlight-color:transparent; user-select:none; pointer-events:all; transition:all 0.15s; }
  .turn-btn:active { background:rgba(255,179,0,0.15); border-color:var(--amber); transform:scale(0.9); }
  .turn-btn:disabled { opacity:0.2; cursor:not-allowed; transform:none !important; }

  /* MAP ëª¨ë‹¬ */
  #map-modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:1000; align-items:center; justify-content:center; }
  #map-modal.show { display:flex; }
  #map-panel { width:92vw; max-width:500px; max-height:85vh; background:var(--dark); border:2px solid var(--amber-dim); border-radius:14px; overflow:hidden; display:flex; flex-direction:column; }
  #map-header { padding:10px 14px; background:var(--panel); border-bottom:1px solid var(--amber-dim); display:flex; align-items:center; justify-content:space-between; flex-shrink:0; }
  #map-header h2 { font-size:0.7rem; letter-spacing:3px; color:var(--amber); }
  #map-hint { font-size:0.55rem; color:rgba(255,179,0,0.5); font-family:'Share Tech Mono',monospace; margin-top:2px; }
  #close-map { background:none; border:1px solid rgba(255,51,34,0.5); color:var(--red); font-size:1rem; width:30px; height:30px; border-radius:6px; cursor:pointer; }
  #map-body { padding:16px; overflow-y:auto; flex:1; }
  .map-section-title { font-size:0.58rem; letter-spacing:2px; color:rgba(255,179,0,0.6); margin-bottom:10px; }
  #quick-btns { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:20px; }
  .quick-btn { padding:10px 14px; border-radius:10px; border:1px solid rgba(255,179,0,0.4); background:rgba(255,179,0,0.05); color:var(--amber); font-family:'Orbitron',monospace; font-size:0.58rem; font-weight:700; cursor:pointer; -webkit-tap-highlight-color:transparent; transition:all 0.15s; }
  .quick-btn:active { background:rgba(255,179,0,0.2); border-color:var(--amber); }
  #coord-inputs { display:flex; flex-direction:column; gap:8px; }
  #coord-inputs input { background:rgba(255,179,0,0.05); border:1px solid rgba(255,179,0,0.3); border-radius:8px; padding:10px 12px; color:var(--amber); font-family:'Share Tech Mono',monospace; font-size:0.65rem; outline:none; width:100%; }
  #coord-inputs input::placeholder { color:rgba(255,179,0,0.3); }
  #coord-go-btn { padding:12px; border-radius:8px; border:2px solid var(--green); background:rgba(0,230,118,0.05); color:var(--green); font-family:'Orbitron',monospace; font-size:0.65rem; font-weight:700; cursor:pointer; margin-top:4px; }

  #loading-screen { position:absolute; inset:0; background:var(--dark); display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:200; gap:14px; }
  #loading-screen h2 { font-size:0.8rem; letter-spacing:4px; color:var(--amber); }
  .loader-bar { width:160px; height:2px; background:rgba(255,179,0,0.2); border-radius:2px; overflow:hidden; }
  .loader-fill { height:100%; background:var(--amber); box-shadow:0 0 8px var(--amber); animation:load 2s ease forwards; }
  @keyframes load { from{width:0} to{width:100%} }
</style>
</head>
<body>

<div id="top-controls">
  <div id="header-info">
    <h1>ğŸšŒ BUS SIM</h1>
    <div id="loc-name">ë‚´ë°©ì—­ ì‚¬ê±°ë¦¬ Â· ì„œìš¸</div>
  </div>
  <button id="start-btn" onclick="toggleEngine()">ì‹œë™ ON</button>
  <button id="map-btn" onclick="openMap()">ğŸ—º MAP</button>
</div>

<div id="main-container">
  <div id="pillar-left"></div>
  <div id="pillar-right"></div>
  <div id="roadview"></div>
  <div id="status-bar">â–  ENGINE OFF</div>

  <div id="bus-dash">
    <div id="dash-panel">
      <div id="engine-light">
        <div id="eng-dot"></div>
        <div id="eng-label">ENG</div>
      </div>
      <div id="wheel-area">
        <div id="left-zone">
          <button class="turn-btn" id="left-btn" disabled
            ontouchstart="onLeftPress()" ontouchend="onLeftRelease()"
            onmousedown="onLeftPress()" onmouseup="onLeftRelease()">â—€</button>
        </div>
        <div id="wheel-container">
          <svg id="steering-wheel" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" onclick="playHorn()">
            <defs>
              <linearGradient id="wg" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#8a6200"/>
                <stop offset="50%" style="stop-color:#ffb300;stop-opacity:0.9"/>
                <stop offset="100%" style="stop-color:#5a3c00"/>
              </linearGradient>
              <radialGradient id="hg" cx="50%" cy="40%">
                <stop offset="0%" style="stop-color:#3a2800"/>
                <stop offset="100%" style="stop-color:#1a1000"/>
              </radialGradient>
            </defs>
            <circle cx="100" cy="100" r="88" fill="none" stroke="#2a1c00" stroke-width="20"/>
            <circle cx="100" cy="100" r="88" fill="none" stroke="url(#wg)" stroke-width="12"/>
            <circle cx="100" cy="100" r="88" fill="none" stroke="rgba(255,179,0,0.15)" stroke-width="2"/>
            <path d="M100 88 L100 18" stroke="#3a2800" stroke-width="14" stroke-linecap="round"/>
            <path d="M100 88 L100 18" stroke="#6a4800" stroke-width="9" stroke-linecap="round"/>
            <path d="M100 112 L20 155" stroke="#3a2800" stroke-width="14" stroke-linecap="round"/>
            <path d="M100 112 L20 155" stroke="#6a4800" stroke-width="9" stroke-linecap="round"/>
            <path d="M100 112 L180 155" stroke="#3a2800" stroke-width="14" stroke-linecap="round"/>
            <path d="M100 112 L180 155" stroke="#6a4800" stroke-width="9" stroke-linecap="round"/>
            <circle cx="100" cy="100" r="30" fill="url(#hg)" stroke="#5a3c00" stroke-width="3"/>
            <circle cx="100" cy="100" r="22" fill="#120e00" stroke="#3a2800" stroke-width="1.5"/>
            <text x="100" y="97" text-anchor="middle" fill="rgba(255,179,0,0.5)" font-size="7" font-family="Orbitron" font-weight="700">BUS</text>
            <text x="100" y="107" text-anchor="middle" fill="rgba(255,179,0,0.3)" font-size="5" font-family="Orbitron">SIM</text>
          </svg>
        </div>
        <div id="right-zone">
          <button class="turn-btn" id="right-btn" disabled
            ontouchstart="onRightPress()" ontouchend="onRightRelease()"
            onmousedown="onRightPress()" onmouseup="onRightRelease()">â–¶</button>
        </div>
      </div>
    </div>
  </div>

  <div id="loading-screen">
    <h2>ğŸšŒ BUS SIM</h2>
    <div class="loader-bar"><div class="loader-fill"></div></div>
    <p style="font-family:'Share Tech Mono',monospace;font-size:0.6rem;color:rgba(255,179,0,0.4);margin-top:8px;">ë‚´ë°©ì—­ ì‚¬ê±°ë¦¬ ë¡œë”© ì¤‘...</p>
  </div>
</div>

<!-- MAP ëª¨ë‹¬ -->
<div id="map-modal">
  <div id="map-panel">
    <div id="map-header">
      <div>
        <h2>â—ˆ ìœ„ì¹˜ ì„ íƒ</h2>
        <div id="map-hint">ì¥ì†Œë¥¼ ì„ íƒí•˜ê±°ë‚˜ ì¢Œí‘œë¥¼ ì…ë ¥í•˜ì„¸ìš”</div>
      </div>
      <button id="close-map" onclick="closeMap()">âœ•</button>
    </div>
    <div id="map-body">
      <p class="map-section-title">ğŸ“ ë¹ ë¥¸ ì¥ì†Œ ì„ íƒ</p>
      <div id="quick-btns">
        <button class="quick-btn" onclick="quickGo(37.4875,126.9822,'ë‚´ë°©ì—­ ì‚¬ê±°ë¦¬')">ë‚´ë°©ì—­ ì‚¬ê±°ë¦¬</button>
        <button class="quick-btn" onclick="quickGo(37.5102,126.9947,'ë™ì‘ëŒ€êµ')">ë™ì‘ëŒ€êµ</button>
        <button class="quick-btn" onclick="quickGo(37.5665,126.9780,'ì„œìš¸ì‹œì²­')">ì„œìš¸ì‹œì²­</button>
        <button class="quick-btn" onclick="quickGo(37.5172,127.0473,'ê°•ë‚¨ì—­')">ê°•ë‚¨ì—­</button>
        <button class="quick-btn" onclick="quickGo(37.5700,126.9836,'ê´‘í™”ë¬¸')">ê´‘í™”ë¬¸</button>
        <button class="quick-btn" onclick="quickGo(37.5133,127.1028,'ì ì‹¤ì—­')">ì ì‹¤ì—­</button>
        <button class="quick-btn" onclick="quickGo(37.4979,127.0276,'ì–‘ì¬ì—­')">ì–‘ì¬ì—­</button>
        <button class="quick-btn" onclick="quickGo(37.5547,126.9707,'ë§ˆí¬ëŒ€êµ')">ë§ˆí¬ëŒ€êµ</button>
        <button class="quick-btn" onclick="quickGo(37.6176,127.0016,'ë¯¸ì•„ì‚¬ê±°ë¦¬')">ë¯¸ì•„ì‚¬ê±°ë¦¬</button>
        <button class="quick-btn" onclick="quickGo(37.5407,127.0694,'ê±´ëŒ€ì…êµ¬')">ê±´ëŒ€ì…êµ¬</button>
        <button class="quick-btn" onclick="quickGo(37.5563,126.9223,'ì‹ ì´Œ')">ì‹ ì´Œ</button>
        <button class="quick-btn" onclick="quickGo(37.5048,126.9548,'ë…¸ëŸ‰ì§„')">ë…¸ëŸ‰ì§„</button>
      </div>
      <p class="map-section-title">ğŸ”¢ ì§ì ‘ ì¢Œí‘œ ì…ë ¥</p>
      <div id="coord-inputs">
        <input type="number" id="input-lat" placeholder="ìœ„ë„ (ì˜ˆ: 37.5665)" step="0.0001"/>
        <input type="number" id="input-lng" placeholder="ê²½ë„ (ì˜ˆ: 126.9780)" step="0.0001"/>
        <button id="coord-go-btn" onclick="goByCoord()">ì´ë™</button>
      </div>
    </div>
  </div>
</div>

<script>
// â”€â”€ AUDIO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let audioCtx = null;
function getCtx() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  return audioCtx;
}
function playHorn() {
  const ctx = getCtx(), now = ctx.currentTime;
  const o1=ctx.createOscillator(), o2=ctx.createOscillator(), o3=ctx.createOscillator();
  const gain=ctx.createGain(), filter=ctx.createBiquadFilter();
  filter.type='bandpass'; filter.frequency.value=250; filter.Q.value=2;
  o1.type='sawtooth'; o2.type='sawtooth'; o3.type='square';
  o1.frequency.value=155; o2.frequency.value=195; o3.frequency.value=130;
  o1.connect(filter); o2.connect(filter); o3.connect(filter);
  filter.connect(gain); gain.connect(ctx.destination);
  gain.gain.setValueAtTime(0,now);
  gain.gain.linearRampToValueAtTime(0.6,now+0.08);
  gain.gain.setValueAtTime(0.6,now+1.5);
  gain.gain.linearRampToValueAtTime(0,now+2.0);
  o1.start(now); o2.start(now); o3.start(now);
  o1.stop(now+2.0); o2.stop(now+2.0); o3.stop(now+2.0);
}

// â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DEFAULT_POS = { lat:37.4875, lng:126.9822 };
const TURN_STEP = 12;
const DRIVE_INTERVAL = 800;

// â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let engineOn=false, driveTimer=null, turnTimer=null;
let heading=0, currentPos={...DEFAULT_POS};
let roadview=null, rvClient=null;
let currentPanoId=null;

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('load', ()=>{
  setTimeout(()=>{
    document.getElementById('loading-screen').style.display='none';
    initRoadview();
  }, 2200);
});

function initRoadview() {
  roadview = new kakao.maps.Roadview(document.getElementById('roadview'));
  rvClient = new kakao.maps.RoadviewClient();

  kakao.maps.event.addListener(roadview, 'init', function() {
    // ì´ˆê¸°í™” í›„ viewpointë¡œ heading ë™ê¸°í™”
    const vp = roadview.getViewpoint();
    heading = vp.pan || 0;
  });

  kakao.maps.event.addListener(roadview, 'position_changed', function() {
    const pos = roadview.getPosition();
    if (pos) {
      currentPos.lat = pos.getLat();
      currentPos.lng = pos.getLng();
      document.getElementById('loc-name').textContent =
        currentPos.lat.toFixed(4)+'Â°N, '+currentPos.lng.toFixed(4)+'Â°E';
    }
  });

  moveTo(DEFAULT_POS.lat, DEFAULT_POS.lng);
}

// â”€â”€ ì¢Œí‘œë¡œ ê°€ì¥ ê°€ê¹Œìš´ ë¡œë“œë·°ë¡œ ì´ë™ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function moveTo(lat, lng) {
  const position = new kakao.maps.LatLng(lat, lng);
  rvClient.getNearestPanoId(position, 50, function(panoId) {
    if (panoId === null) {
      setStatus('âš  ì´ ìœ„ì¹˜ì— ë¡œë“œë·° ì—†ìŒ');
      return;
    }
    currentPanoId = panoId;
    roadview.setPanoId(panoId, position);
    setTimeout(()=>{ roadview.setViewpoint({pan:heading, tilt:0, zoom:0}); }, 400);
  });
}

// â”€â”€ ENGINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleEngine() {
  engineOn = !engineOn;
  const btn=document.getElementById('start-btn');
  const dot=document.getElementById('eng-dot');
  const lb=document.getElementById('left-btn');
  const rb=document.getElementById('right-btn');
  if (engineOn) {
    btn.textContent='ì‹œë™ OFF'; btn.classList.add('running');
    dot.classList.add('on'); lb.disabled=false; rb.disabled=false;
    setStatus('â–¶ ì£¼í–‰ ì¤‘');
    startDriving();
  } else {
    btn.textContent='ì‹œë™ ON'; btn.classList.remove('running');
    dot.classList.remove('on'); lb.disabled=true; rb.disabled=true;
    setStatus('â–  ENGINE OFF');
    stopDriving(); resetWheel();
  }
}

function startDriving() {
  if (driveTimer) clearInterval(driveTimer);
  driveTimer = setInterval(moveForward, DRIVE_INTERVAL);
}
function stopDriving() { clearInterval(driveTimer); driveTimer=null; }

// â”€â”€ ì „ì§„ ì´ë™ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function moveForward() {
  // heading ë°©í–¥ìœ¼ë¡œ ì•½ 4m ì• ì¢Œí‘œ ê³„ì‚°
  const STEP = 0.00004;
  const rad = heading * Math.PI / 180;
  const nextLat = currentPos.lat + STEP * Math.cos(rad);
  const nextLng = currentPos.lng + STEP * Math.sin(rad);
  const position = new kakao.maps.LatLng(nextLat, nextLng);

  rvClient.getNearestPanoId(position, 40, function(panoId) {
    if (panoId === null) {
      // ë„“ì€ ë²”ìœ„ë¡œ ì¬ì‹œë„
      rvClient.getNearestPanoId(position, 100, function(panoId2) {
        if (panoId2 === null) { stopDriving(); setStatus('ğŸ›‘ ë„ë¡œ ë'); return; }
        applyPanoId(panoId2, position);
      });
      return;
    }
    applyPanoId(panoId, position);
  });
}

function applyPanoId(panoId, position) {
  if (panoId === currentPanoId) return; // ê°™ì€ ìœ„ì¹˜ë©´ ë¬´ì‹œ
  currentPanoId = panoId;
  roadview.setPanoId(panoId, position);
  // ì¹´ë©”ë¼ ë°©í–¥ ìœ ì§€ (ì´ë™ í›„ ìë™ìœ¼ë¡œ ëŒì•„ê°€ëŠ” ê²ƒ ë°©ì§€)
  setTimeout(()=>{ roadview.setViewpoint({pan:heading, tilt:0, zoom:0}); }, 250);
}

// â”€â”€ í•¸ë“¤ ì¡°ì‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function onLeftPress() {
  if (!engineOn) return;
  doTurn('left');
  turnTimer = setInterval(()=>doTurn('left'), 200);
}
function onLeftRelease() { clearInterval(turnTimer); turnTimer=null; resetWheel(); }

function onRightPress() {
  if (!engineOn) return;
  doTurn('right');
  turnTimer = setInterval(()=>doTurn('right'), 200);
}
function onRightRelease() { clearInterval(turnTimer); turnTimer=null; resetWheel(); }

function doTurn(dir) {
  heading = (heading + (dir==='left' ? -TURN_STEP : TURN_STEP) + 360) % 360;
  document.getElementById('steering-wheel').style.transform =
    `rotate(${dir==='left'?-38:38}deg)`;
  roadview.setViewpoint({pan:heading, tilt:0, zoom:0});
}
function resetWheel() {
  document.getElementById('steering-wheel').style.transform='rotate(0deg)';
}

// â”€â”€ MAP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openMap() { document.getElementById('map-modal').classList.add('show'); }
function closeMap() { document.getElementById('map-modal').classList.remove('show'); }

function quickGo(lat, lng, name) {
  currentPos={lat,lng}; heading=0;
  document.getElementById('loc-name').textContent=name+' Â· ì„œìš¸';
  closeMap();
  moveTo(lat, lng);
}

function goByCoord() {
  const lat=parseFloat(document.getElementById('input-lat').value);
  const lng=parseFloat(document.getElementById('input-lng').value);
  if (isNaN(lat)||isNaN(lng)||lat<33||lat>39||lng<124||lng>132) {
    alert('ì˜¬ë°”ë¥¸ í•œêµ­ ì¢Œí‘œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
    return;
  }
  currentPos={lat,lng}; heading=0;
  document.getElementById('loc-name').textContent=lat.toFixed(4)+'Â°N, '+lng.toFixed(4)+'Â°E';
  closeMap();
  moveTo(lat, lng);
}

function setStatus(msg) { document.getElementById('status-bar').textContent=msg; }

// â”€â”€ í‚¤ë³´ë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('keydown',(e)=>{
  if(e.key==='ArrowLeft') onLeftPress();
  if(e.key==='ArrowRight') onRightPress();
  if(e.key===' '){ e.preventDefault(); toggleEngine(); }
  if(e.key==='m'||e.key==='M') openMap();
  if(e.key==='h'||e.key==='H') playHorn();
});
document.addEventListener('keyup',(e)=>{
  if(e.key==='ArrowLeft') onLeftRelease();
  if(e.key==='ArrowRight') onRightRelease();
});
</script>
</body>
</html>
